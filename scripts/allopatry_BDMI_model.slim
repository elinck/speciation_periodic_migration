// set up speciation by drift w/ BDMI model
initialize() {
	initializeMutationRate(1e-6);
	
	// m1 mutation type: BDMI locus a
	initializeMutationType("m1", 1.0, "f", 0.5);
	
	// m2 mutation type: neutral
	initializeMutationType("m2", 0.5, "f", 0.0);
	
	// m3 mutation type: BDMI locus b
	initializeMutationType("m3", 1.0, "f", 0.5);
	
	// g1 genomic element type for locus a
	initializeGenomicElementType("g1", m1, 1.0);
	
	// g2 genomic element type for locus b
	initializeGenomicElementType("g2", m2, 1.0);
	
	// g3 genomic element type for other loci
	initializeGenomicElementType("g3", m3, 1.0);
	
	// specify genomic regions (BDMI loci 1 site each)
	initializeGenomicElement(g1, 0, 0);
	initializeGenomicElement(g2, 1, 98);
	initializeGenomicElement(g3, 99, 99);
	initializeRecombinationRate(1e-8);
}

// create a population of 100 individuals
1 {
	sim.addSubpop("p1", 50);
	sim.addSubpop("p2", 50);
}

// delete bad mutations in p1 
1: late() {
sim.mutations[sim.mutations.originGeneration == sim.generation & sim.mutations.subpopID == 2].setMutationType(m2);
}


// stop simulation when both loci have drifted to fixation
1:500000 late() {
	count1 = sum(p1.genomes.countOfMutationsOfType(m1));
	count2 = sum(p1.genomes.countOfMutationsOfType(m3));
	if (count1 > 50 & count2 > 50)
	{
			sim.simulationFinished();
			sim.outputFixedMutations();
			line = paste(sim.generation);
			writeFile("~/Dropbox/speciation_periodic_migration/data/simple_model_output/allopatry.txt", line, append=T);
		}
}